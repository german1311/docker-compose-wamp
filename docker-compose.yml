version: "3"

services:
  webserver:
    build:
      context: ./bin/webserver
    container_name: 'my-webserver'
    restart: 'always'
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ${DOCUMENT_ROOT-./www}:/var/www/html
      - ${PHP_INI-./config/php/php.ini}:/usr/local/etc/php/php.ini
      - ${VHOSTS_DIR-./config/vhosts}:/etc/apache2/sites-enabled
      - ${LOG_DIR-./logs/apache2}:/var/log/apache2
    networks:
      - web-db-net
  testlink:
    image: docker.io/bitnami/testlink:1
    ports:
      - '8080:8080'
      - '8443:8443'
    environment:
      - TESTLINK_DATABASE_HOST=129.158.63.139
      - TESTLINK_DATABASE_PORT_NUMBER=3306
      - TESTLINK_DATABASE_USER=root
      - TESTLINK_DATABASE_NAME=bitnami_testlink
      - TESTLINK_DATABASE_PASSWORD_FILE=/run/secrets/db_password
    volumes:
      - 'testlink_data:/bitnami/testlink'
    secrets:
       - db_password
secrets:
   db_password:
     file: db_password.txt
networks:
  web-db-net:
volumes:
  mariadb_data:
    driver: local
  testlink_data:
    driver: local